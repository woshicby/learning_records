# 第五章 Hash函数

## 5.1 Hash概念和基本要求

### 5.1.1 Hash函数的定义

**Hash函数/哈希函数/散列函数/压缩函数/杂凑函数/指纹函数……**：把任意长的信息M映射为较短的、固定长度的一个值$H(M)$。

Hash函数的函数值$H(M)$常称为**哈希值/散列值/杂凑码/指纹/信息摘要……**

Hash函数一般是公开的。

例子①（简单的Hash函数）：M是一个长消息，设$M=(M_1,M_2,\cdots,M_k)$，其中$M_i$为l长的比特串，定义函数$H(M)=M_1\oplus M_2\oplus\cdots\oplus M_k$，这就是一个哈希函数。

### 5.1.2 Hash函数满足条件及安全性定义

Hash函数的目的：为需认证的数据产生一个“指纹”。

Hash函数应该满足以下条件：
①Hash函数的输入可以是任意长
②Hash函数的输出是固定长
③易于在软件和硬件实现。

Hash函数为了实现安全认证，需要满足以下安全条件：
①单向性：已知x，求H(x)较为容易；但是，已知h，求使得$H(x)=h$的x在计算上是不可行的。
②抗弱碰撞性：已知x，找出$y(y\neq x)$使得$H(y)=H(x)$在计算上是不可行的。
③抗强碰撞性：找出任意两个不同的输入$x,y$，使得$H(x)=H(y)$在计算上是不可行的。

例子①符合单向性，不符合抗强碰撞性和抗弱碰撞性。

三个安全性的关系：$抗强碰撞性\Rightarrow抗弱碰撞性\Rightarrow单向性$。

### 5.1.3 Hash函数迭代构造

迭代型Hash函数的一般结构：![迭代型Hash函数的一般结构](第五章 Hash函数.assets/迭代型Hash函数的一般结构.png)

其中$\begin{cases}M=(CV_0,CV_1,\cdots,CV_L)\\CV_0=IV=n比特长的初始值\\CV_i=f(CV_{i-1},Y_{i-1})(1\le i\le L)\\H(M)=CV_L\end{cases}$。

## 5.2 生日攻击

### 5.2.1 生日攻击相关问题

**第一类生日攻击问题**：已知一个Hash函数H有n个可能的输出，H(x)是一个特定的输出，如果对H随机取k个输入，则至少有一个输入y使得$H(y)=H(x)$的概率为0.5时，k有多大？

**第一类生日攻击**：对Hash函数寻找上述y的攻击称为**第一类生日攻击**。

**第一类生日攻击问题的解**：因为H有n个可能的输出，所以输入y产生的输出H(y)等于特定输出H(x)的概率是$\frac{1}{n}$，反过来说$H(y)\neq H(x)$的概率是$1-\frac{1}{n}$。

y取k个随机值而函数的k个输出中没有一个等于H(x)，其概率等于每个输出都不等于H(x)的概率之积，为$1-\frac{1}{n}$，所以y取k个随机值得到函数的k个输出中至少有一个等于H(x)的概率为$1-(1-\frac{1}{n})^k$。

由当$\abs{x}<<1,(1+x)^k\approx1+kx$，可得$1-(1-\frac{1}{n})^k\approx1-(1-\frac{k}{n})=\frac{k}{n}$

若使上述概率等于0.5，则$k=\frac{n}{2}$。特别地，如果H的输出为m比特长，即可能的输出个数$n=2^m$，则$k=2^{m-1}$。

问题2（**生日悖论**）：在k个人中至少有两个人的生日相同的概率大于0.5时，k至少多大？

**生日悖论的解**：设有k个整数项，每一项都在1到n之间等可能地取值。

设$P(n,k)$：k个整数项中至少有两个取值相同的概率。 生日悖论即求使得$P(365,k)\ge0.5$的最小k。

设$Q(365,k)$：k个数据项中任意两个取值都不同的概率。则$P(365,k)=1-Q(365,k)$。

若$k\gt365$，则不可能使得任意两个数据都不相同，故$k\le365$。k个数据项中任意两个都不相同的取值方式有$365\times364\times\cdots\times(365-k+1)=\frac{365!}{(365-k)!}$而去除该条件的取值方式有$365^k$种。

所以$\begin{cases}Q(365,k)-\frac{365!}{(365-k)!365^k}\\P(365,k)=1-Q(365,k)=1-\frac{365!}{(365-k)!365^k}\end{cases}$

所以$k=23$时，$P(365,23)=0.5073$即只要有23个人，则其中有两个人生日相同的概率就超过0.5了。

而$k=100$时，$P(365,100)=0.9999997$概率极大。

由于人数k给定时，得到的至少有两个人的生日相同的概率比想象中大得多，故称之为生日悖论。

**生日悖论推广问题**：已知一个在1到n之间均匀分布的整数型随机变量，若改变量的k个曲子中至少有2个取值相同的概率大于0.5，这k至少多大？

**生日悖论的推广问题的解**：$P(n,k)=1-\frac{n!}{(n-k)!n^k}$，令$P(n,k)\gt0.5$，可得$k=1.18\sqrt{n}\approx\sqrt{n}$，取n=365时，$k=1.18\sqrt{365}=22.54$。

**生日攻击**：设Hash函数有$2^m$个可能的输出（即输出长为m比特），若H的k个随机输入中至少有两个产生相同输出的概率大于0.5，则$k\approx\sqrt{2^m}=2^{\frac{m}{2}}$

**第二类生日攻击**：寻找函数H的具有相同输出的两个任意输入的攻击方式。

这种生日攻击给出了消息摘要长度的下界：一个40比特的消息摘要是非常不安全的，因为在大约$2^{20}$个（大约100万）个随机值中就能以$\frac12$的概率找到一个碰撞。

通常建议消息摘要的最小可接受长度为128比特，在DSS签名标准中使用160比特的消息摘要就是基于这个考虑。

## 5.3 SHA-1算法

## 5.4 SM3算法

